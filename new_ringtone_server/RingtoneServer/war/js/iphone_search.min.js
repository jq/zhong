(function(a){a(function(){a("#search").submit(function(e,g){var b=a("#search_result");var h=a("input[id=search-text]",this).attr("value");if(h==null||h.length==0){confirm("The search key word should not be empty.");return}jQT.goTo(b);var d=a("#results",b).empty();var f="Tap to load more";var c="/ringtoneserver/search?q="+h;a(".loader",b).bind("ajaxSend",function(){var j=a(".store",b).length;if(j==0){a("ul",b).hide();a(this).show()}}).bind("ajaxComplete",function(){a("ul",b).show();a(this).hide()});a.getJSON(c,function(j){if(j.length==0){window.alert("No result");return}a.each(j,function(l,m){var k=jsonToListItem(m);k.appendTo(d)});a('<li id="load_more">').text(f).appendTo(d);a("#load_more",b).click(function(){append_more(b,c)});a("#load_more",b).bind("ajaxSend",function(){a(this).text("Loading...")}).bind("ajaxComplete",function(){a(this).text("Tap to load more");a(this).appendTo(d)})});return false})})})(jQuery);function fill_details_page(e,k,h,j,c,d,a){var b=$("#details");last_email=localStorage.last_email;clearRate();if(last_email){$("#email_text",b).attr("value",last_email)}$("audio",b).remove();$("#s3_image",b).attr("src",d);$(".artist",b).text(e);$(".title",b).text(k);$(".download_count",b).text("Downloaded "+j+" times");$("#rate_star",b).attr("class",h);$("#uuid",b).attr("value",a);var f=$("<audio>").attr("src",c).attr("class","player").attr("controls","controls");var g=$("a",".music_info",b);f.appendTo(g)}function fill_cate_page(e,c){var d=$("#category");$("h1",d).text(c);var b=$("#results",d);b.empty();var a="/ringtoneserver/search?q="+e+"&type=category";$(".loader",d).bind("ajaxSend",function(){var f=$(".store",d).length;if(f==0){$("ul",d).hide();$(this).show()}}).bind("ajaxComplete",function(){$(this).hide();$("ul",d).show()});$.getJSON(a,function(g){if(g.length==0){window.alert("No result");return}$.each(g,function(j,k){var h=jsonToListItem(k);h.appendTo(b)});var f="Tap to load more";$('<li id="load_more">').text(f).appendTo(b);$("#load_more",d).click(function(){append_more(d,a)});$("#load_more",d).bind("ajaxSend",function(){$(this).text("Loading...")}).bind("ajaxComplete",function(){$(this).text("Tap to load more");$(this).appendTo(b);setHeight($(this))})})}$(document).ready(function(a){$("#top_download").bind("pageAnimationStart",function(e,g){if(g.direction=="in"){var h=this;var c=$(".store",this).length;if(c>0){return}var d=$("#results",this).empty();var f="Tap to load more";var b="/ringtoneserver/search?type=download_count";$(".loader",this).bind("ajaxSend",function(){var j=$(".store","#top_download").length;if(j==0){$("ul","#top_download").hide();$(this).show()}}).bind("ajaxComplete",function(){$("ul","#top_download").show();$(this).hide()});$.getJSON(b,function(j){if(j.length==0){window.alert("No result");return}$.each(j,function(l,m){var k=jsonToListItem(m);k.appendTo(d)});$('<li id="load_more">',h).text(f).appendTo(d);$("#load_more",$("#top_download")).click(function(){append_more($("#top_download"),b)});$("#load_more",$("#top_download")).bind("ajaxSend",function(){$(this).text("Loading...")}).bind("ajaxComplete",function(){$(this).text("Tap to load more");$(this).appendTo(d)})})}})});$(document).ready(function(a){$("#details").bind("pageAnimationStart",function(b,c){if(c.direction=="out"){$("audio",this).remove()}})});$(document).ready(function(a){$("#newest_add").bind("pageAnimationStart",function(f,h){if(h.direction=="in"){var e=this;var c=$(".store",this).length;if(c>0){return}var d=$("#results",this).empty();var g="Tap to load more";var b="/ringtoneserver/search?type=add_date";$(".loader",this).bind("ajaxSend",function(){var j=$(".store","#newest_add").length;if(j==0){$("ul","#newest_add").hide();$(this).show()}}).bind("ajaxComplete",function(){$("ul","#newest_add").show();$(this).hide()});$.getJSON(b,function(j){if(j.length==0){window.alert("No result");return}$.each(j,function(l,m){var k=jsonToListItem(m);k.appendTo(d)});$('<li id="load_more">',e).text(g).appendTo(d);$("#load_more",$("#newest_add")).click(function(){append_more($("#newest_add"),b)});$("#load_more",$("#newest_add")).bind("ajaxSend",function(){$(this).text("Loading...")}).bind("ajaxComplete",function(){$(this).text("Tap to load more");$(this).appendTo(d)})})}})});function append_more(c,a){var b=$("#results",c);var e=$("#load_more",c);var d=$(".store",c).length;$.getJSON(a+"&start="+d,function(f){$.each(f,function(g,h){var j=jsonToListItem(h);j.appendTo(b)});if($(".store",c).length>50){e.hide()}})}function jsonToListItem(n){var k=$("<span></span>").attr("class","arrow");var d=$("<span></span>").attr("class","artist").attr("value",n.artist).text(n.artist);var j=$("<span></span>").attr("class","title").attr("value",n.title).text(n.title);var e;if(n.avg_rate==0){e=$("<span></span>").attr("class","stars0").attr("value",n.avg_rate)}else{if(n.avg_rate<=20){e=$("<span></span>").attr("class","stars1").attr("value",n.avg_rate)}else{if(n.avg_rate<=40){e=$("<span></span>").attr("class","stars2").attr("value",n.avg_rate)}else{if(n.avg_rate<=60){e=$("<span></span>").attr("class","stars3").attr("value",n.avg_rate)}else{if(n.avg_rate<=90){e=$("<span></span>").attr("class","stars4").attr("value",n.avg_rate)}else{if(n.avg_rate<=100){e=$("<span></span>").attr("class","stars5").attr("value",n.avg_rate)}}}}}}var g=$("<span></span>").attr("style","display:none;").attr("class","download_count").attr("value",n.download_count).text(n.down);var f=$("<img></img>").attr("src","/images/spinner.gif");var c=$("<img></img>").attr("src",n.image).hide();c.load(function(a){f.hide();c.fadeIn()});c.error(function(a){f.attr("src","/images/load_failed.png")});var m='javascript:fill_details_page("'+n.artist+'","'+n.title+'","'+e.attr("class")+'","'+n.download_count+'","'+n.s3url+'","'+n.image+'","'+n.uuid+'");';var h=$("<a></a>").attr("href","#details").attr("class","song_item").attr("onClick",m).attr("song_id",n.uuid).attr("value",n.s3url);var l=$("<li></li>").attr("class","store");var b=h.append(f).append(k).append(c).append(d).append(j).append(e).append(g);return l.append(b)}function sendEmail(b,c){if(!isEmail(b)){confirm("The format is not correct.");return}else{localStorage.last_email=b;if(!isExpireAndRecord(b,c)){return}var a="/ringtoneserver/sendemail?uuid="+c+"&email="+b;$.get(a,function(d){if(d=="ok"){confirm("The email will be send in several minutes, please download the ringtone from your computer and read the instructions which will tell you how to install the ringtone with iTunes.")}else{confirm("The request for sending email failed. Please try again.")}})}}function isExpireAndRecord(b,e){var f=new Date();var d=b+e;var c=sessionStorage.key;var a=f.getTime();if(c+5000<a){sessionStorage.key=a;return false}else{sessionStorage.key=a;return true}}function isEmail(a){if(a.search(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)!=-1){return true}else{return false}}function clearRate(){for(i=1;i<=5;i++){$("#star"+i).html("<img src='/images/empty_star.png'></img>")}}function doRate(b){for(i=1;i<=b;i++){$("#star"+i).html("<img src='/images/full_star.png'></img>")}for(i=b+1;i<=5;i++){$("#star"+i).html("<img src='/images/empty_star.png'></img>")}var c=$("#uuid").attr("value");var a="/ringtoneserver/rate?uuid="+c+"&rate="+b*20;$.get(a,function(d){})};