(function(a){a(function(){a("#search").submit(function(e,g){var b=a("#search_result");var h=a("input[id=search-text]",this).attr("value");if(h==null||h.length==0){confirm("The search key word should not be empty.");return}jQT.goTo(b);var d=a("#results",b).empty();var f="Tap to load more";var c="/ringtoneserver/search?q="+h;a(".loader",b).bind("ajaxSend",function(){var i=a(".store",b).length;if(i==0){a("ul",b).hide();a(this).show()}}).bind("ajaxComplete",function(){a("ul",b).show();a(this).hide()});a.getJSON(c,function(i){if(i.length==0){window.alert("No result");return}a.each(i,function(k,l){var j=jsonToListItem(l);j.appendTo(d)});a('<li id="load_more">').text(f).appendTo(d);a("#load_more",b).click(function(){append_more(b,c)});a("#load_more",b).bind("ajaxSend",function(){a(this).text("Loading...")}).bind("ajaxComplete",function(){a(this).text("Tap to load more");a(this).appendTo(d)})});return false})})})(jQuery);var last_email;function fill_details_page(d,i,g,h,b,c){var a=$("#details");if(last_email!=null){$("#email_text",a).attr("value",last_email)}$("audio",a).remove();$("img",a).attr("src",c);$(".artist",a).text(d);$(".title",a).text(i);$(".download_count",a).text("Downloaded "+h+" times");$("#rate_star",a).attr("class",g);var e=$("<audio>").attr("src",b).attr("class","player").attr("controls","controls");var f=$("a",".music_info",a);e.appendTo(f)}function fill_cate_page(d){var c=$("#category");$("h1",c).text(d);var b=$("#results",c);b.empty();var a="/ringtoneserver/search?q="+d+"&type=category";$(".loader",c).bind("ajaxSend",function(){var e=$(".store",c).length;if(e==0){$("ul",c).hide();$(this).show()}}).bind("ajaxComplete",function(){$(this).hide();$("ul",c).show()});$.getJSON(a,function(f){if(f.length==0){window.alert("No result");return}$.each(f,function(h,j){var g=jsonToListItem(j);g.appendTo(b)});var e="Tap to load more";$('<li id="load_more">').text(e).appendTo(b);$("#load_more",c).click(function(){append_more(c,a)});$("#load_more",c).bind("ajaxSend",function(){$(this).text("Loading...")}).bind("ajaxComplete",function(){$(this).text("Tap to load more");$(this).appendTo(b);setHeight($(this))})})}$(document).ready(function(a){$("#top_download").bind("pageAnimationStart",function(e,g){if(g.direction=="in"){var h=this;var c=$(".store",this).length;if(c>0){return}var d=$("#results",this).empty();var f="Tap to load more";var b="/ringtoneserver/search?type=download_count";$(".loader",this).bind("ajaxSend",function(){var i=$(".store","#top_download").length;if(i==0){$("ul","#top_download").hide();$(this).show()}}).bind("ajaxComplete",function(){$("ul","#top_download").show();$(this).hide()});$.getJSON(b,function(i){if(i.length==0){window.alert("No result");return}$.each(i,function(k,l){var j=jsonToListItem(l);j.appendTo(d)});$('<li id="load_more">',h).text(f).appendTo(d);$("#load_more",$("#top_download")).click(function(){append_more($("#top_download"),b)});$("#load_more",$("#top_download")).bind("ajaxSend",function(){$(this).text("Loading...")}).bind("ajaxComplete",function(){$(this).text("Tap to load more");$(this).appendTo(d)})})}})});$(document).ready(function(a){$("#newest_add").bind("pageAnimationStart",function(f,h){if(h.direction=="in"){var e=this;var c=$(".store",this).length;if(c>0){return}var d=$("#results",this).empty();var g="Tap to load more";var b="/ringtoneserver/search?type=add_date";$(".loader",this).bind("ajaxSend",function(){var i=$(".store","#newest_add").length;if(i==0){$("ul","#newest_add").hide();$(this).show()}}).bind("ajaxComplete",function(){$("ul","#newest_add").show();$(this).hide()});$.getJSON(b,function(i){if(i.length==0){window.alert("No result");return}$.each(i,function(k,l){var j=jsonToListItem(l);j.appendTo(d)});$('<li id="load_more">',e).text(g).appendTo(d);$("#load_more",$("#newest_add")).click(function(){append_more($("#newest_add"),b)});$("#load_more",$("#newest_add")).bind("ajaxSend",function(){$(this).text("Loading...")}).bind("ajaxComplete",function(){$(this).text("Tap to load more");$(this).appendTo(d)})})}})});function append_more(c,a){var b=$("#results",c);var e=$("#load_more",c);var d=$(".store",c).length;$.getJSON(a+"&start="+d,function(f){$.each(f,function(g,h){var j=jsonToListItem(h);j.appendTo(b)});if($(".store",c).length>50){e.hide()}})}function jsonToListItem(k){var i=$("<span></span>").attr("class","arrow");var d=$("<span></span>").attr("class","artist").attr("value",k.artist).text(k.artist);var h=$("<span></span>").attr("class","title").attr("value",k.title).text(k.title);var e;if(k.avg_rate==0){e=$("<span></span>").attr("class","stars0").attr("value",k.avg_rate)}else{if(k.avg_rate<=20){e=$("<span></span>").attr("class","stars1").attr("value",k.avg_rate)}else{if(k.avg_rate<=40){e=$("<span></span>").attr("class","stars2").attr("value",k.avg_rate)}else{if(k.avg_rate<=60){e=$("<span></span>").attr("class","stars3").attr("value",k.avg_rate)}else{if(k.avg_rate<=90){e=$("<span></span>").attr("class","stars4").attr("value",k.avg_rate)}else{if(k.avg_rate<=100){e=$("<span></span>").attr("class","stars5").attr("value",k.avg_rate)}}}}}}var f=$("<span></span>").attr("style","display:none;").attr("class","download_count").attr("value",k.download_count).text(k.down);var c=$("<img></img>").attr("src",k.image);var l='javascript:fill_details_page("'+k.artist+'","'+k.title+'","'+e.attr("class")+'","'+k.download_count+'","'+k.s3url+'","'+k.image+'");';var g=$("<a></a>").attr("href","#details").attr("class","song_item").attr("onClick",l).attr("song_id",k.uuid).attr("value",k.s3url);var j=$("<li></li>").attr("class","store");var b=g.append(c).append(d).append(h).append(e).append(f).append(i);return j.append(b)}function sendEmail(b,c){if(!isEmail(b)){confirm("The format is not correct.");return}else{lastEmail=b;var a="/ringtoneserver/sendemail?download_link="+c+"&email="+b;$.get(a,function(d){if(d=="ok"){confirm("The email will be send in several minutes, please download the ringtone from your computer and read the instructions which will tell you how to install the ringtone with iTunes.")}else{confirm("The request for sending email failed. Please try again.")}})}}function isEmail(a){if(a.search(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)!=-1){return true}else{return false}};